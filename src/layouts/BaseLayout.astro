---
export interface Props {
  title?: string;
  description?: string;
  image?: string;
  type?: 'website' | 'article' | 'profile';
  publishedTime?: string;
  modifiedTime?: string;
  author?: string;
  schema?: Record<string, unknown>;
}

const SITE_URL = 'https://aj-wildridge.web.cern.ch';
const DEFAULT_OG_IMAGE = `${SITE_URL}/images/og-default.png`;

const {
  title = 'Quarks & Qubits',
  description = 'Research in top-quark physics, quantum computing, and machine learning by AJ Wildridge',
  image = DEFAULT_OG_IMAGE,
  type = 'website',
  publishedTime,
  modifiedTime,
  author = 'Andrew James Wildridge',
  schema,
} = Astro.props as Props;

const canonicalURL = new URL(Astro.url.pathname, SITE_URL).href;
const fullTitle = title === 'Quarks & Qubits' ? title : `${title} | AJ Wildridge`;

// Default Person schema for the site owner
const personSchema = {
  '@context': 'https://schema.org',
  '@type': 'Person',
  name: 'Andrew James Wildridge',
  alternateName: 'AJ Wildridge',
  url: SITE_URL,
  jobTitle: 'PhD Student',
  affiliation: {
    '@type': 'Organization',
    name: 'Purdue University',
  },
  alumniOf: [
    {
      '@type': 'Organization',
      name: 'Massachusetts Institute of Technology',
    },
  ],
  email: 'andrew.james.wildridge@cern.ch',
  sameAs: [
    'https://github.com/AWildridge',
    'https://orcid.org/0000-0000-0000-0000',
    'https://scholar.google.com/citations?user=PLACEHOLDER',
  ],
};

// Website schema
const websiteSchema = {
  '@context': 'https://schema.org',
  '@type': 'WebSite',
  name: 'Quarks & Qubits',
  description,
  url: SITE_URL,
  author: personSchema,
  inLanguage: 'en-US',
};

// Combine schemas
const structuredData = schema ? [personSchema, schema] : [personSchema, websiteSchema];
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content={description} />
    <title>{fullTitle}</title>

    <!-- Canonical URL -->
    <link rel="canonical" href={canonicalURL} />

    <!-- OpenGraph / Facebook -->
    <meta property="og:type" content={type} />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={fullTitle} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={image} />
    <meta property="og:site_name" content="Quarks & Qubits" />
    <meta property="og:locale" content="en_US" />
    {publishedTime && <meta property="article:published_time" content={publishedTime} />}
    {modifiedTime && <meta property="article:modified_time" content={modifiedTime} />}
    {author && type === 'article' && <meta property="article:author" content={author} />}

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content={canonicalURL} />
    <meta name="twitter:title" content={fullTitle} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={image} />
    <meta name="twitter:creator" content="@AWildridge" />

    <!-- Additional SEO -->
    <meta name="author" content={author} />
    <meta name="robots" content="index, follow" />
    <link rel="sitemap" href="/sitemap.xml" />

    <!-- Security headers (also set via middleware) -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    <meta http-equiv="X-Frame-Options" content="DENY" />
    <meta name="referrer" content="strict-origin-when-cross-origin" />

    <!-- Structured Data (JSON-LD) -->
    {
      structuredData.map((schema) => (
        <script type="application/ld+json" set:html={JSON.stringify(schema)} />
      ))
    }

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  </head>
  <body>
    <a
      href="#main"
      class="sr-only focus:not-sr-only focus:fixed focus:top-2 focus:left-2 bg-blue-700 text-white px-3 py-2 rounded"
      >Skip to content</a
    >
    <header class="border-b border-gray-200 dark:border-gray-800">
      <div class="mx-auto max-w-6xl px-4 py-4 flex items-center justify-between">
        <a class="font-semibold text-lg" href="/">Quarks &amp; Qubits</a>
        <nav aria-label="Primary">
          <ul class="flex gap-4">
            <li><a class="nav-link" href="/">Home</a></li>
            <li><a class="nav-link" href="/research/">Research</a></li>
            <li><a class="nav-link" href="/projects/">Projects</a></li>
            <li><a class="nav-link" href="/publications/">Publications</a></li>
            <li><a class="nav-link" href="/cv/">CV</a></li>
            <li><a class="nav-link" href="/contact/">Contact</a></li>
          </ul>
        </nav>
      </div>
    </header>
    <main id="main" tabindex="-1" class="mx-auto max-w-6xl px-4 py-8">
      <slot />
    </main>
    <footer class="border-t border-gray-200 dark:border-gray-800">
      <div class="mx-auto max-w-6xl px-4 py-6 text-sm text-gray-600 dark:text-gray-400">
        Â© {new Date().getFullYear()} AJ Wildridge
      </div>
    </footer>
  </body>
</html>

<style is:global>
  .nav-link {
    @apply text-blue-700 dark:text-blue-400 underline-offset-2 hover:underline focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 rounded px-1 py-0.5;
  }
  @media (prefers-reduced-motion: reduce) {
    * {
      animation-duration: 0.001ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.001ms !important;
      scroll-behavior: auto !important;
    }
  }
</style>
